package {{ groupId }}.{{ artifactId }}.{{ name_lowercase }}

import {{ groupId }}.{{ artifactId }}.util.MergeUtil.mergeWithNullify
import org.springframework.data.annotation.*
import org.springframework.data.relational.core.mapping.Table
import java.time.LocalDate
import java.time.LocalDateTime

@Table("{{ _names }}")
data class {{ Name }}(
    @Id
    val id: Int? = null{{#each fields }},
    val {{ fieldNameCamelCase }}: {{ fieldKotlinType }}{{/each}},

    @CreatedDate
    val createdAt: LocalDateTime? = null,

    @LastModifiedDate
    val updatedAt: LocalDateTime? = null
) {

    constructor(input: Create{{ Name }}Input) : this({{#each fields }}
        {{fieldNameCamelCase}} = input.{{fieldNameCamelCase}},{{/each}}
    )

    fun merge(update{{ Name }}Input: Update{{ Name }}Input): {{ Name }} {
        return this mergeWithNullify update{{ Name }}Input
    }

    data class Create{{ Name }}Input({{#each fields}}
        val {{ fieldNameCamelCase }}: {{ fieldKotlinType }},{{/each}}
    )

    data class Update{{ Name }}Input({{#each fields}}
        val {{ fieldNameCamelCase }}: {{ fieldKotlinType }},{{/each}}{{#each fields}}{{#if isFieldNullable}}
        val nullify{{ fieldNamePascalCase }}: Boolean? = null,{{/if}}{{/each}}
    )
{{#if hasRelations}}
    data class {{ Name }}FilterInput({{#each fields }}{{#if isFieldRelational}}
        val {{ fieldNameCamelCase }}: {{ fieldKotlinTypeNotNullable }}? = null,{{/if}}{{/each}}
    )
{{/if}}
}
