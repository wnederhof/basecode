{{=<% %>=}}<template>
  <div v-if="$apollo.loading">
    Loading...
  </div>
  <form
    v-else
    ref="<%name%>Form"
    @submit.prevent="save<%Name%>"
  >
    <input
      v-if="<%name%>.id"
      id="id"
      v-model="<%name%>.id"
      type="hidden"
    >
<%#each fields%>
    <div>
      <label for="<%fieldName%>"><%FieldName%></label>
      <input
        id="<%fieldName%>"
        ref="<%fieldName%>-input"
        v-model="<%name%>.<%fieldName%>"
        type="text"
      >
    </div><%/each%>
    <div>
      <button>Save <%Name%></button>
      <button
        ref="cancel-btn"
        type="button"
        @click="close"
      >
        Close <%Name%>
      </button>
    </div>
  </form>
</template>

<script lang="ts">
import { Vue } from 'vue-property-decorator'
import Component from 'nuxt-class-component'
import gql from 'graphql-tag'

@Component({
  apollo: {
    <%name%>: {
      query: gql`
        query <%name%>ById($id: Int) {
          <%name%>: <%name%>ById(id: $id) {
            id<%#each fields%>
            <%fieldName%><%/each%>
          }
        }
      `,

      variables () {
        return {
          id: this.$props.<%name%>Id
        }
      },

      skip () {
        return !this.$props.<%name%>Id
      },

      result({data}) {
        this.<%name%> = Object.assign({}, data.<%name%>)
      }
    }
  },

  props: { <%name%>Id: [Number, String] }
})
export default class <%Name%>Form extends Vue {
  <%name%> = { <%#each fields%><%fieldName%>: '', <%/each%> }

  async save<%Name%> () {
    const mutation = gql`
      mutation save<%Name%>($<%name%>: <%Name%>Input!) {
        save<%Name%>(<%name%>: $<%name%>) {
          id<%#each fields%>
          <%fieldName%><%/each%>
        }
      }
    `

    const variables: any = Object.assign({}, this.<%name%>)
    delete variables.__typename

    await this.$apollo.mutate({
      mutation,
      variables,
      update: () => {
        this.$apollo.getClient().resetStore()
      }
    })

    this.$emit('save:<%name%>', this.<%name%>)
  }

  close() {
    this.$emit('close:<%name%>Form')
  }
}
</script><%={{ }}=%>
