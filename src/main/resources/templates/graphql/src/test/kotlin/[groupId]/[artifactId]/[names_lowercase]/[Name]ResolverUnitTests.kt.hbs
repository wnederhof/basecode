package {{ groupId }}.{{ artifactId }}.{{ names_lowercase }}

import {{ groupId }}.{{ artifactId }}.{{ names_lowercase }}.{{ Name }}Fixtures.{{ NAME }}_FIXTURE_1
import {{ groupId }}.{{ artifactId }}.{{ names_lowercase }}.{{ Name }}Fixtures.{{ NAME }}_FIXTURE_WITH_ID_1
{{#each fields}}{{#if fieldRelationship}}import {{ groupId }}.{{ artifactId }}.{{ fieldTypes }}.{{ FieldType }}Fixtures.{{ FIELD_TYPE }}_FIXTURE_WITH_ID_1
import {{ groupId }}.{{ artifactId }}.{{ fieldTypes }}.{{ FieldType }}Service
{{/if}}{{/each}}import com.nhaarman.mockitokotlin2.verify
import com.nhaarman.mockitokotlin2.whenever
import org.assertj.core.api.Assertions.assertThat
import org.junit.jupiter.api.Nested
import org.junit.jupiter.api.Test
import org.junit.jupiter.api.extension.ExtendWith
import org.mockito.InjectMocks
import org.mockito.Mock
import org.mockito.junit.jupiter.MockitoExtension

class {{ Name }}ResolverUnitTests {

    @Nested
    @ExtendWith(MockitoExtension::class)
    inner class RootQueryResolverUnitTests {

        @Mock
        private lateinit var {{ name }}Service: {{ Name }}Service

        @InjectMocks
        private lateinit var rootQueryResolver: {{ Name }}Resolver.RootQueryResolver

        @Test
        fun `{{ name }} delegates the call to the {{ Name }}Service`() {
            whenever({{ name }}Service.findById(1))
                .thenReturn({{ NAME }}_FIXTURE_WITH_ID_1)

            assertThat(rootQueryResolver.{{ name }}(1))
                .isEqualTo({{ NAME }}_FIXTURE_WITH_ID_1)
        }

        @Test
        fun `{{ names }} delegates the call to the {{ Name }}Service`() {
            val any{{ Name }}Filter = {{ Name }}Filter()

            whenever({{ name }}Service.findAll(any{{ Name }}Filter))
                .thenReturn(listOf({{ NAME }}_FIXTURE_WITH_ID_1))

            assertThat(rootQueryResolver.all{{ Names }}(any{{ Name }}Filter))
                .isEqualTo(listOf({{ NAME }}_FIXTURE_WITH_ID_1))
        }

    }

    @Nested
    @ExtendWith(MockitoExtension::class)
    inner class MutationResolverUnitTests {

        @Mock
        private lateinit var {{ name }}Service: {{ Name }}Service

        @InjectMocks
        private lateinit var {{ name }}MutationResolver: {{ Name }}Resolver.MutationResolver

        @Test
        fun `save delegates the call to the {{ Name }}Service`() {
            whenever({{ name }}Service.save({{ NAME }}_FIXTURE_1))
                .thenReturn({{ NAME }}_FIXTURE_WITH_ID_1)

            assertThat({{ name }}MutationResolver.save{{ Name }}({{ NAME }}_FIXTURE_1))
                .isEqualTo({{ NAME }}_FIXTURE_WITH_ID_1)
        }

        @Test
        fun `delete{{ Name }} delegates the call to the {{ Name }}Service`() {
            {{ name }}MutationResolver.delete{{ Name }}(1)

            verify({{ name }}Service).deleteById(1)
        }

    }
{{#if hasRelations}}
    @Nested
    @ExtendWith(MockitoExtension::class)
    inner class {{ Name }}ResolverUnitTests { {{#each fields}}{{#if fieldRelationship}}

        @Mock
        private lateinit var {{ fieldType }}Service: {{ FieldType }}Service{{/if}}{{/each}}

        @InjectMocks
        private lateinit var {{ name }}QueryResolver: {{ Name }}Resolver.{{ Name }}QueryResolver
{{#each fields}}{{#if fieldRelationship}}
        @Test
        fun `{{ fieldType }} delegates the call to the {{ FieldType }}Service`() {
            whenever({{ fieldType }}Service.findById({{ NAME }}_FIXTURE_WITH_ID_1.{{ fieldName }}))
                .thenReturn({{ FIELD_TYPE }}_FIXTURE_WITH_ID_1)

            assertThat({{ name }}QueryResolver.{{ fieldType }}({{ NAME }}_FIXTURE_WITH_ID_1))
                .isEqualTo({{ FIELD_TYPE }}_FIXTURE_WITH_ID_1)
        }{{/if}}{{/each}}
    }
{{/if}}{{#each fields}}{{#if fieldRelationship}}
    @Nested
    @ExtendWith(MockitoExtension::class)
    inner class {{ FieldType }}ResolverUnitTests {

        @Mock
        private lateinit var {{ name }}Service: {{ Name }}Service

        @InjectMocks
        private lateinit var {{ fieldType }}FieldResolver: {{ Name }}Resolver.{{ FieldType }}FieldResolver

        @Test
        fun `{{ name }} delegates the call to the {{ name }}Service`() {
            whenever({{ name }}Service.findBy{{ FieldName }}({{ FIELD_TYPE }}_FIXTURE_WITH_ID_1.id!!))
                .thenReturn(listOf({{ NAME }}_FIXTURE_WITH_ID_1))

            assertThat({{ fieldType }}FieldResolver.{{ names }}({{ FIELD_TYPE }}_FIXTURE_WITH_ID_1))
                .isEqualTo(listOf({{ NAME }}_FIXTURE_WITH_ID_1))
        }

    }
{{/if}}{{/each}}
}
