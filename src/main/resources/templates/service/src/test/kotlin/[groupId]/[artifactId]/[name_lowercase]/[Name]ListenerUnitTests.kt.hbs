{{#if hasRelations}}package {{ groupId }}.{{ artifactId }}.{{ name_lowercase }}

{{#each fields as |f|}}{{#if isFieldRelational}}import {{ groupId }}.{{ artifactId }}.{{ fieldTypeLowerCase }}.{{ fieldTypePascalCase }}Event.Before{{ fieldTypePascalCase }}DeletedEvent
import {{ groupId }}.{{ artifactId }}.{{ fieldTypeCamelCases_lowercas }}.{{ fieldTypePascalCase }}Service
{{/if}}{{/each}}{{#if hasRelations}}import com.nhaarman.mockitokotlin2.verify
import org.junit.jupiter.api.Test{{/if}}
import org.junit.jupiter.api.extension.ExtendWith
import org.mockito.InjectMocks{{#if hasRelations}}
import org.mockito.Mock{{/if}}
import org.mockito.junit.jupiter.MockitoExtension

@ExtendWith(MockitoExtension::class)
internal class {{ Name }}ListenerUnitTests{{#if hasRelations}}{

    @Mock
    private lateinit var {{ name }}Service: {{ Name }}Service

    @InjectMocks
    private lateinit var {{ name }}Listener: {{ Name }}Listener
{{#each fields as |f|}}{{#if isFieldRelational}}
    @Test
    fun `deleteBefore{{ fieldTypePascalCase }}Deleted deletes related {{ Names }} in Before{{ fieldTypePascalCase }}DeletedEvent`() {
        {{ name }}Listener.deleteBefore{{ fieldTypePascalCase }}Deleted(Before{{ fieldTypePascalCase }}DeletedEvent(this, 1))

        verify({{ name }}Service).deleteBy{{ fieldNamePascalCase }}(1)
    }
{{/if}}{{/each}}
}{{/if}}{{/if}}
