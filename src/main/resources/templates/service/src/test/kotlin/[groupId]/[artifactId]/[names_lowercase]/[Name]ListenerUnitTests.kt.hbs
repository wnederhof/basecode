package {{ groupId }}.{{ artifactId }}.{{ names_lowercase }}

{{#each fields as |f|}}{{#if fieldRelationship}}import {{ groupId }}.{{ artifactId }}.{{ fieldTypes_lowercase }}.{{ FieldType }}Event.Before{{ FieldType }}DeletedEvent
import {{ groupId }}.{{ artifactId }}.{{ fieldTypes_lowercase }}.{{ FieldType }}Service
{{/if}}{{/each}}{{#if hasRelations}}import com.nhaarman.mockitokotlin2.verify
import org.junit.jupiter.api.Test{{/if}}
import org.junit.jupiter.api.extension.ExtendWith
import org.mockito.InjectMocks{{#if hasRelations}}
import org.mockito.Mock{{/if}}
import org.mockito.junit.jupiter.MockitoExtension

@ExtendWith(MockitoExtension::class)
internal class {{ Name }}ListenerUnitTests{{#if hasRelations}}{

    @Mock
    private lateinit var {{ name }}Service: {{ Name }}Service

    @InjectMocks
    private lateinit var {{ name }}Listener: {{ Name }}Listener
{{#each fields as |f|}}{{#if fieldRelationship}}
    @Test
    fun `deleteBefore{{ FieldType }}Deleted deletes related {{ Names }} in Before{{ FieldType }}DeletedEvent`() {
        {{ name }}Listener.deleteBefore{{ FieldType }}Deleted(Before{{ FieldType }}DeletedEvent(this, 1))

        verify({{ name }}Service).deleteBy{{ FieldName }}(1)
    }
{{/if}}{{/each}}
}{{/if}}
