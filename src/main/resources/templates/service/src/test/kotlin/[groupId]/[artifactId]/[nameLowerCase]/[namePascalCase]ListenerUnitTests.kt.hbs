{{#if hasRelations}}package {{ groupId }}.{{ artifactId }}.{{ nameLowerCase }}

{{#each fields as |f|}}{{#if isFieldRelational}}import {{ groupId }}.{{ artifactId }}.{{ fieldTypeLowerCase }}.{{ fieldTypePascalCase }}Event.Before{{ fieldTypePascalCase }}DeletedEvent
{{/if}}{{/each}}{{#if hasRelations}}import com.nhaarman.mockitokotlin2.verify
import org.junit.jupiter.api.Test{{/if}}
import org.junit.jupiter.api.extension.ExtendWith
import org.mockito.InjectMocks{{#if hasRelations}}
import org.mockito.Mock{{/if}}
import org.mockito.junit.jupiter.MockitoExtension

@ExtendWith(MockitoExtension::class)
internal class {{ namePascalCase }}ListenerUnitTests{{#if hasRelations}}{

    @Mock
    private lateinit var {{ nameCamelCase }}Service: {{ namePascalCase }}Service

    @InjectMocks
    private lateinit var {{ nameCamelCase }}Listener: {{ namePascalCase }}Listener
{{#each fields as |f|}}{{#if isFieldRelational}}
    @Test
    fun `deleteBefore{{ fieldTypePascalCase }}Deleted deletes related {{ namePluralPascalCase }} in Before{{ fieldTypePascalCase }}DeletedEvent`() {
        {{ nameCamelCase }}Listener.deleteBefore{{ fieldTypePascalCase }}Deleted(Before{{ fieldTypePascalCase }}DeletedEvent(this, 1))

        verify({{ nameCamelCase }}Service).deleteBy{{ fieldNamePascalCase }}(1)
    }
{{/if}}{{/each}}
}{{/if}}{{/if}}
